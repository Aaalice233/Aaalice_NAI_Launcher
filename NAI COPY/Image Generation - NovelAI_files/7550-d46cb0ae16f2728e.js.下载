!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i=(new e.Error).stack;i&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[i]="1b845b50-207c-43d2-98d8-89df2e5b7cf3",e._sentryDebugIdIdentifier="sentry-dbid-1b845b50-207c-43d2-98d8-89df2e5b7cf3")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7550],{27550:(e,i,s)=>{s.r(i),s.d(i,{LoadingOverlay:()=>J,ModalLogin:()=>X,default:()=>q});var t=s(94458),n=s(89441),o=s(68658),r=s(20851),a=s.n(r),l=s(55805),c=s(29415),d=s.n(c),h=s(21681),p=s.n(h),y=s(38474),u=s(48370),g=s(53875),f=s(84601),m=s(79630),x=s(97223),w=s(26907),v=s(74700),_=s(71928),b=s(92704),j=s(17391),k=s(85703),A=s(19058),L=s(98883),S=s(17309),I=s(74767),C=s(27524),T=s(41963);let D={src:"/_next/static/media/dedgoose.562fc318.svg"};var R=s(2585),B=s(83513),G=s(36814),N=s(73484),E=s(32761),F=s(27481),H=s(2834),O=s(52746),U=s(88587),V=s(82685),Y=s(39979);function q(){let e=(0,o.useMemo)(()=>(0,t.jsx)(R.A,{forLogin:!0}),[]);return(0,t.jsxs)(w.j$,{children:[(0,t.jsx)(p(),{children:(0,t.jsx)("title",{children:"Login - NovelAI"})}),(0,t.jsx)(E.t,{children:(0,t.jsx)(F.N9,{transition:E.R})}),e,(0,t.jsx)(w.yD,{}),(0,t.jsx)(K,{})]})}function z(e){let i=(0,N.B2)(),{capture:r}=(0,B.A)(),l=(0,H.md)((0,x.ey)("authenticated")),c=(0,H.md)(x.Nn),[h,p]=(0,o.useState)(""),[b,k]=(0,o.useState)(""),[A,R]=(0,o.useState)(""),[G,E]=(0,o.useState)(!0),[F,O]=(0,o.useState)(!0),[q,z]=(0,o.useState)([]),K=(0,y.useRouter)(),J=e.fullSetup,P=(0,j.w)(J),[$,M]=(0,o.useState)(!1),[X,Q]=(0,o.useState)(!1);(0,o.useEffect)(()=>{l&&(c.information.emailVerified||c.information.accountCreatedAt<=C.xT)||l&&!(c.information.emailVerified||c.information.accountCreatedAt<=C.xT)&&((0,_.FF)("unauthorized session, not logging in"),E(!0))},[l,K,c.information.emailVerified,c.information.emailVerificationLetterSent,c.information.accountCreatedAt,e]);let Z=async(i,s)=>{try{(0,L.Dg)(-1),await P(i,F),E(!0),e.onLogin(),e.setLoading(!1)}catch(s){if(s?.message.includes("A mutation operation was attempted on a database that did not allow mutations."))R("Firefox private browsing is not supported as it does not support IndexedDB.");else if(s?.message.includes("Invalid Access Key"))R("Invalid email or password.");else if(s?.message.includes("Internal error.")){i?.settings&&M(!(0,f.cv)(i.settings,"remoteDefault")),Q(!0),E(!0),(0,_.vV)(s,!1);return}else R("Error processing user data: "+(s?.message??s));E(!0),e.setLoading(!1),(0,_.vV)(s,!1)}},ee=async i=>{if(!i.access_key||!i.encryption_key)throw e.setLoading(!1),Error("Something went wrong, account data incomplete");let s=new g.KJ(i.session.auth_token,i.encryption_key);s.subscription=i.subscription??new g.Bx,s.settings=i.settings??new f.tl,s.authenticated=i.session.authenticated,s.priority=i.priority??new g.Wl,s.information=i.information??new g._C,s.keystoreReady=i.session.keystoreReady,s.hasKeystore=i.session.hasKeystore,m.C.keystore=i.session.keystore,await Z(s,i.email||"")},ei=async i=>{e.setLoading(!0),i?.preventDefault(),z([]),M(!1);let t=h.toLowerCase();if(!t||!b)return void R("Email and Password cannot be empty");if(!t.includes("@")||t.length<=3)return void R("Email must be in email format");if(b.length<8)return void R("Password must be 8 characters or more");E(!1),R(""),await a().ready,(0,S.$1)("session");try{let i,o={email:void 0,access_key:void 0,encryption_key:void 0,subscription:void 0,session:void 0,settings:void 0,priority:void 0,information:void 0},r={email:void 0,access_key:void 0,encryption_key:void 0,subscription:void 0,session:void 0,settings:void 0,priority:void 0,information:void 0};try{o.access_key=a().crypto_pwhash(64,new Uint8Array(n.Buffer.from(b)),a().crypto_generichash(a().crypto_pwhash_SALTBYTES,b.slice(0,6)+t+"novelai_data_access_key"),2,2e6,a().crypto_pwhash_ALG_ARGON2ID13,"base64").slice(0,64),o.encryption_key=a().crypto_pwhash(128,new Uint8Array(n.Buffer.from(b)),a().crypto_generichash(a().crypto_pwhash_SALTBYTES,b.slice(0,6)+t+"novelai_data_encryption_key"),2,2e6,a().crypto_pwhash_ALG_ARGON2ID13,"base64");let e=await (async()=>{if(!s.g.window||!U.H3)return;if(!await (0,_.Ur)()){alert(N.G6.value.authFormGeneral.recaptchaNotLoaded),K.push("/login");return}let e=s.g.window.grecaptcha.enterprise;return await new Promise(i=>e.ready(i)),await e.execute(U.H3,{action:"LOGIN"}).catch(e=>{(0,_.vV)(e,!1,"recaptcha execute failed:")})})(),i=(0,u.zH)(o.access_key,o.encryption_key,void 0,e),r=await i.login();o.subscription=r.subscription,o.session=r.session,o.settings=r.settings,o.priority=r.priority,o.information=r.information,o.email=t}catch(e){(0,_.fH)(e,!1,"login failed:"),i=e}if(h!==t)try{r.access_key=a().crypto_pwhash(64,new Uint8Array(n.Buffer.from(b)),a().crypto_generichash(a().crypto_pwhash_SALTBYTES,b.slice(0,6)+h+"novelai_data_access_key"),2,2e6,a().crypto_pwhash_ALG_ARGON2ID13,"base64").slice(0,64),r.encryption_key=a().crypto_pwhash(128,new Uint8Array(n.Buffer.from(b)),a().crypto_generichash(a().crypto_pwhash_SALTBYTES,b.slice(0,6)+h+"novelai_data_encryption_key"),2,2e6,a().crypto_pwhash_ALG_ARGON2ID13,"base64");let e=(0,u.zH)(r.access_key,r.encryption_key),i=await e.login();r.subscription=i.subscription,r.session=i.session,r.settings=i.settings,r.priority=i.priority,r.email=h}catch(e){(0,_.fH)(e,!1,"legacy login failed:")}let l=t.slice(0,1).toUpperCase()+t.slice(1);if(!r.session&&!o.session&&l!==h&&l!==t)try{if(l!==t){r.access_key=a().crypto_pwhash(64,new Uint8Array(n.Buffer.from(b)),a().crypto_generichash(a().crypto_pwhash_SALTBYTES,b.slice(0,6)+l+"novelai_data_access_key"),2,2e6,a().crypto_pwhash_ALG_ARGON2ID13,"base64").slice(0,64),r.encryption_key=a().crypto_pwhash(128,new Uint8Array(n.Buffer.from(b)),a().crypto_generichash(a().crypto_pwhash_SALTBYTES,b.slice(0,6)+l+"novelai_data_encryption_key"),2,2e6,a().crypto_pwhash_ALG_ARGON2ID13,"base64");let e=(0,u.zH)(r.access_key,r.encryption_key),i=await e.login();r.subscription=i.subscription,r.session=i.session,r.settings=i.settings,r.priority=i.priority,r.email=l}}catch(e){(0,_.fH)(e,!1,"legacy login failed:")}if(r.session||o.session)if(r.session&&!o.session)o.subscription=r.subscription,o.session=r.session,o.settings=r.settings,o.priority=r.priority,o.access_key=r.access_key,o.encryption_key=r.encryption_key;else if(!r.session&&o.session);else{z([o,r]),e.setLoading(!1),E(!0);return}else throw i;ee(o)}catch(i){e.setLoading(!1),i?.message.includes("A mutation operation was attempted on a database that did not allow mutations.")?R("Firefox private browsing is not supported as it does not support IndexedDB."):i?.message.includes("Invalid Access Key")?R("Invalid email or password."):R("Login Error: "+(i?.message??i)),E(!0),(0,_.vV)(i,!1)}},[es,et]=(0,o.useState)(!1);function en(e){"Enter"===e.key&&""!==h&&""!==b&&ei()}return(0,o.useEffect)(()=>et(!!s.g.window?.localStorage),[]),(0,Y.m)(),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.cj,{isOpen:X,label:"Local Storage Unavailable",iconURL:D.src,iconSize:75,width:450,confirmButtonText:"Continue without local storage",neverMindText:"Cancel",confirm:async()=>{(0,T.ru)(),Q(!1),ei()},cancel:()=>Q(!1),deny:()=>Q(!1),warningText:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{children:(0,t.jsx)("strong",{children:"A browser-internal error occurred."})}),(0,t.jsxs)("p",{children:["This issue is specific to Chromium-based browsers and might resolve by itself after restarting your browser or after some time.",(0,t.jsx)("br",{}),(0,t.jsx)("div",{style:{opacity:.5,paddingTop:"5px"},children:"If the issue persists, you can also try clearing your browser cache, note that this will also delete locally-only stored stories."})]}),(0,t.jsx)("p",{children:(0,t.jsxs)("strong",{children:["You can still use NovelAI, but your data will not be saved locally and locally stored stories will be unavailable.",$&&" Storage will also be set to remote."]})})]})}),(0,t.jsx)("div",{children:(0,t.jsx)("label",{htmlFor:"username",children:i.general.email})}),(0,t.jsx)(w.D0,{id:"username",value:h,disabled:!G,onChange:e=>{z([]),p(e.target.value)},onKeyDown:en,type:"email",autoComplete:"email",required:!0}),(0,t.jsx)("div",{children:(0,t.jsx)("label",{htmlFor:"password",children:i.general.password})}),(0,t.jsx)(w.D0,{id:"password",value:b,disabled:!G,onChange:e=>{z([]),k(e.target.value)},onKeyDown:en,type:"password",autoComplete:"current-password",required:!0}),es?(0,t.jsx)(v.Ay,{style:{flexDirection:"column",gap:0,alignItems:"flex-start"},alternate:!0,label:i.authFormGeneral.rememberMe,value:F,setValue:O,checkedText:i.authFormGeneral.loginRemembered,uncheckedText:i.authFormGeneral.loginNotRemembered}):null,(0,t.jsx)("div",{style:{marginBottom:"20px"}}),q.length>0?(0,t.jsx)(W,{accounts:q,login:ee}):(0,t.jsx)(w.XT,{type:"submit",value:G?i.general.signIn:i.general.loading,disabled:!G,onClick:ei}),(0,t.jsx)(V.X,{height:10}),(0,t.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,t.jsx)("div",{style:{fontSize:"1.25rem",fontWeight:"bold"},children:i.common.or}),(0,t.jsx)(V.X,{height:10}),(0,t.jsx)("div",{style:{height:"40px"},className:"google_login_button"})]}),(0,t.jsx)(w.PE,{children:(0,t.jsxs)("p",{children:[i.authFormGeneral.googleTermsNote[0],(0,t.jsxs)("a",{href:"https://policies.google.com/privacy",target:"_blank",rel:"noreferrer",children:[" ",i.authFormGeneral.googleTermsNote[1]]})," ",i.authFormGeneral.googleTermsNote[2],(0,t.jsxs)("a",{href:"https://policies.google.com/terms",target:"_blank",rel:"noreferrer",children:[" ",i.authFormGeneral.googleTermsNote[3]]})," ",i.authFormGeneral.googleTermsNote[4]]})}),(0,t.jsxs)(w.Qd,{children:[A?`${A}`:"",(0,t.jsx)("p",{children:(0,t.jsx)(d(),{href:`/reset?email=${h}`,legacyBehavior:!0,children:i.passwordReset.resetPassword})})]}),(0,t.jsx)("div",{style:{height:"70px"}})]})}function K(){let e=(0,N.B2)(),{capture:i}=(0,B.A)(),s=(0,y.useRouter)(),[n,r]=(0,o.useState)(!1);function a(){let e=s.query.redirect;if(e&&"string"==typeof e)s.replace(e);else if((0,S.Lg)("loginRedirect")){let e=(0,S.Lg)("loginRedirect");switch((0,S.$1)("loginRedirect"),e){case"stories":s.replace("/stories");break;case"image":s.replace("/image")}}else s.replace("/stories")}(0,o.useEffect)(()=>{s.isReady&&r(void 0===s.query.redirect||"stories"===s.query.redirect)},[s.isReady,s.query.redirect]);let[l,c]=(0,H.fp)(x.S5);return(0,k.e)(()=>{c(!0),a()},()=>{c(!1)},!1,n,!1),(0,t.jsxs)(w.Z3,{children:[(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",height:"100%",width:"100%"},children:[(0,t.jsxs)(w.nR,{children:[(0,t.jsxs)(d(),{href:"/",passHref:!0,scroll:!1,children:[(0,t.jsx)(b.A60,{}),e.common.back]}),(0,t.jsx)(G.J,{shouldSave:!1}),(0,t.jsx)(d(),{onClick:()=>{i("sign-up:clicked",{location:"login"})},href:"/register",legacyBehavior:!0,children:e.general.signUp})]}),(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%",minHeight:"0",position:"relative",alignItems:"center",justifyContent:"center",flex:"1 1 0"},children:(0,t.jsx)("div",{style:{width:"100%",maxHeight:"100%",position:"absolute",overflowY:"auto",display:"flex",justifyContent:"center"},children:(0,t.jsxs)("div",{style:{width:"100%",maxWidth:"290px",minHeight:"0"},children:[(0,t.jsxs)(w.FJ,{children:[(0,t.jsx)("div",{children:e.general.logIn}),(0,t.jsx)("div",{children:e.general.welcomeBack})]}),(0,t.jsx)(z,{onLogin:()=>{a()},fullSetup:n,setLoading:c})]})})})]}),(0,t.jsx)(J,{visible:l,children:(0,t.jsx)(A.k,{visible:!0})})]})}let J=l.Ay.div.withConfig({componentId:"sc-630f4015-0"})(["display:",";width:100%;height:100%;position:absolute;background:",";opacity:0.5;top:0;left:0;justify-content:center;align-items:center;"],e=>e.visible?"flex":"none",e=>e.theme.colors.bg2),P=l.Ay.div.withConfig({componentId:"sc-630f4015-1"})(["display:flex;flex-direction:column;gap:10px;"]),$=l.Ay.label.withConfig({componentId:"sc-630f4015-2"})([""]),M=(0,l.Ay)(w.XT).withConfig({componentId:"sc-630f4015-3"})([""]);function W(e){return(0,t.jsxs)(P,{children:[(0,t.jsx)($,{children:"We found multiple accounts with your details, select the account you want to log in with below."}),e.accounts.map(i=>(0,t.jsx)(M,{type:"button",value:i.email,onClick:()=>e.login(i)},i.email))]})}function X(e){let[i,s]=(0,H.fp)(x.Nn),n=(0,N.B2)(),[r,a]=(0,H.fp)(x.Hw),[l,c]=(0,o.useState)("text"===e.page),[d,h]=(0,H.fp)(x.S5),p=(0,y.useRouter)();return(0,o.useEffect)(()=>{p.isReady&&c("/stories"===p.pathname)},[p.isReady,p.pathname]),(0,t.jsx)(O.A,{type:O.q.Large,isOpen:r,shouldCloseOnOverlayClick:!0,onRequestClose:()=>a(!1),style:{justifyContent:"flex-end"},children:(0,t.jsxs)(Q,{children:[(0,t.jsx)(I.Jn,{onClick:()=>a(!1),children:(0,t.jsx)("div",{})}),i.noAccount&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{style:{padding:"0px 30px"},children:(0,t.jsxs)(w.FJ,{children:[(0,t.jsx)("div",{children:n.general.logIn}),(0,t.jsx)("div",{style:{fontSize:"1.5rem"},children:n.general.welcomeBack})]})}),(0,t.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%",position:"relative",alignItems:"center",overflowY:"auto",padding:"0px 30px 30px"},children:(0,t.jsxs)("div",{style:{width:"100%"},children:[(0,t.jsx)(z,{onLogin:()=>{a(!1)},setLoading:h,fullSetup:l}),(0,t.jsx)("div",{style:{height:"20px"}})]})})]}),d&&(0,t.jsx)(J,{visible:d,children:(0,t.jsx)(A.k,{visible:!0})})]})})}let Q=l.Ay.div.withConfig({componentId:"sc-630f4015-4"})(["width:100%;background:",";border-radius:3px;border:1px solid ",";display:flex;flex-direction:column;padding-top:60px;max-width:410px;@media (max-width:800px){max-width:100%;}"],e=>e.theme.colors.bg2,e=>e.theme.colors.bg3)}}]);