!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="cdbc63e5-92de-4477-81fd-fbe632aaa607",e._sentryDebugIdIdentifier="sentry-dbid-cdbc63e5-92de-4477-81fd-fbe632aaa607")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9854],{75561:(e,t,n)=>{n.d(t,{K8:()=>h,fO:()=>f});var o=n(47553),r=n(74406),i=n(93040);let s=(0,i.st)(i.Z1,i.iz,i.aw),l=(0,i.st)(i.Z1,i.iz,i.UI),c=(0,i.st)(i.ic,i.Qv,i._e,i.Ou),a=(0,i.st)(i.ic,i.eT,i.Sd),d={Enter:s,"Shift-Enter":l,Backspace:c,"Mod-Backspace":c,"Shift-Backspace":c,Delete:a,"Mod-Delete":a,"Mod-a":i.Ub},p={...d,"Ctrl-h":c,"Alt-Backspace":c,"Ctrl-d":a,"Ctrl-Alt-Backspace":a,"Alt-Delete":a,"Alt-d":a,"Ctrl-a":i.$f,"Ctrl-e":i.ec},f=r.U0?p:d;function u(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==n&&t.shiftKey&&(e="Shift-"+e),e}function h(e){let t=function(e){let t=Object.create(null);for(let n in e)t[function(e){let t,n,o,i,s=e.split(/-(?!$)/),l=s[s.length-1];"Space"==l&&(l=" ");for(let e=0;e<s.length-1;e++){let l=s[e];if(/^(cmd|meta|m)$/i.test(l))i=!0;else if(/^a(lt)?$/i.test(l))t=!0;else if(/^(c|ctrl|control)$/i.test(l))n=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))r.U0?i=!0:n=!0;else throw Error("Unrecognized modifier name: "+l)}return t&&(l="Alt-"+l),n&&(l="Ctrl-"+l),i&&(l="Meta-"+l),o&&(l="Shift-"+l),l}(n)]=e[n];return t}(e);return function(e,n){let r,i=(0,o.xT)(n),s=1==i.length&&" "!=i,l=t[u(i,n,!s)];if(l&&l(e.state,t=>e.dispatch(t),e))return!0;if(s&&(n.shiftKey||n.altKey||n.metaKey||(i.codePointAt(0)??0)>127)&&(r=o.E3[n.keyCode])&&r!=i){let o=t[u(r,n,!0)];if(o&&o(e.state,t=>e.dispatch(t),e))return!0}else if(s&&n.shiftKey){let o=t[u(i,n,!0)];if(o&&o(e.state,t=>e.dispatch(t),e))return!0}return!1}}},89854:(e,t,n)=>{n.d(t,{$8:()=>I,$d:()=>b,$j:()=>M,BF:()=>w,Bo:()=>k,GO:()=>g,Lb:()=>S,Lv:()=>y,Tz:()=>m,Xl:()=>h,Zl:()=>u,jX:()=>x,qf:()=>f,tz:()=>v,uf:()=>z,w4:()=>p,yO:()=>T});var o=n(49882),r=n(6084),i=n(19482),s=n(88587),l=n(53518),c=n(75561),a=n(75586),d=n(57259);function p(e){let t=new o.hs("keymap");return new o.k_({key:t,props:{handleKeyDown:(0,c.K8)(e)}})}let f=()=>{let e=new o.hs("placeholder");return new o.k_({key:e,props:{decorations:e=>{let t=[];return e.doc.content.size<=2&&t.push(i.NZ.node(0,e.doc.content.size,{class:"empty-node"})),i.zF.create(e.doc,t)}}})},u=()=>{let e=new o.hs("clipboardTransform");return new o.k_({key:e,props:{plainTextPaste:!0,clipboardTextSerializer:e=>(0,a.hf)(e.content),clipboardTextParser:a.ls,transformPastedHTML:a.Qm}})},h=e=>{let t=new o.hs("propsOverride");return new o.k_({key:t,props:{...e}})},g=(e,t)=>{let n=new o.hs("inspectNodeChangesKey");return new o.k_({key:n,state:{init(){},apply(n,o,i,s){let l=n.getMeta("internal"),c=n.getMeta("forceupdate");if(!0===l||!n.docChanged&&!0!==c)return;let d=(0,a.K6)(n,[]),p=new Map;if(s.doc.content.size>2)for(let e of d){let n=!1;if(e.getMap().forEach((e,o,r,i)=>{n=!0,s.doc.content.nodesBetween(r,i>s.doc.content.size?s.doc.content.size:i,(e,n,o,r)=>{if(o||!e.attrs.id)return!1;let i=r>0?s.doc.content.child(r-1):t()?void 0:0;return p.set(e.attrs.id,{node:e,after:i}),!1})}),!n&&c){let n=e.toJSON();n.from&&n.to&&n.from<n.to&&s.doc.content.nodesBetween(n.from,n.to,(e,n,o,r)=>{if(o||!e.attrs.id)return!1;let i=r>0?s.doc.content.child(r-1):t()?void 0:0;return p.set(e.attrs.id,{node:e,after:i}),!1})}}let f={};for(let e of d)e instanceof r.Ln&&e.from>=e.to||e.getMap().forEach((e,n,o,r)=>{let s=Object.keys(f).reduce((t,n)=>Number(n)<e?t+1:t,e),l=Object.keys(f).reduce((e,t)=>Number(t)<n?e+1:e,n);if(i.doc.content.nodesBetween(s,l,(e,n,o,r)=>{if(o||!e.attrs.id)return!1;let s=r>0?i.doc.content.child(r-1):t()?void 0:0;return p.has(e.attrs.id)||p.set(e.attrs.id,{after:s}),!1}),o===r)for(let e=s;e<l;e++)f[e]=!0});p.size>0&&e(p)}}})},m=()=>{let e=new o.hs("nodeIds"),t={active:new Set};return new o.k_({key:e,appendTransaction(e,n,r){if(r.doc.content.size<=2)return;let i=e.filter(e=>e.docChanged);if(0===i.length)return;let s=r.tr,c=[];for(let e of i)c=(0,a.K6)(e,c);if(c){for(let e of c)e.getMap().forEach((e,n,i,c)=>{i>=r.doc.content.size||i>=c||!r.doc.content.childCount||(c>r.doc.content.size&&(c=r.doc.content.size),r.doc.content.nodesBetween(i,c,(e,n,r)=>{if(r)return!1;if(e.attrs.id)t.active.add(e.attrs.id);else{let r=(0,l.FB)();for(;t.active.has(r);)r=(0,l.FB)();s.setNodeMarkup(n,void 0,{...e.attrs,id:r}),s.selection.anchor<n&&s.setSelection(o.U3.create(s.doc,n+1)),t.active.add(r)}return!1}))});return s}}})},y=e=>{let{enabled:t}=e,n=new o.hs("updateSource");return new o.k_({key:n,appendTransaction(e,n,o){if(!t()||o.doc.content.size<=2)return;let r=e.filter(e=>e.docChanged);if(0===r.length)return;let i=o.tr,s=[];for(let e of r)s=(0,a.K6)(e,s);if(!s)return;let l=0,c=new Set;for(let e of s)e.structure||e.getMap().forEach((e,t,n,r)=>{n>=o.doc.content.size||n>=r||!o.doc.content.childCount||(r>o.doc.content.size&&(r=o.doc.content.size),o.doc.content.nodesBetween(n,r,(e,t,n)=>{if(n)return!1;if(!e.attrs.source&&e.textContent.startsWith(">")){if(c.has(e.attrs.id))return!1;c.add(e.attrs.id);let n=1;" "===e.textContent.charAt(1)&&(n=2),e.textContent.slice(n)?i.replaceRangeWith(t+1+l,Math.min(t+l+e.nodeSize,i.doc.content.size),o.schema.text(e.textContent.slice(n))):i.delete(t+1+l,t+2+l),i.setNodeMarkup(t+l,void 0,{...e.attrs,source:d.Y1.action}),l-=n}return!1}))});return i}})},w=()=>{let e=new o.hs("updateSource");return new o.k_({key:e,appendTransaction(e,t,n){if(n.doc.content.size<=2)return;let o=e.filter(e=>e.docChanged);if(0===o.length)return;let r=n.tr,i=[];for(let e of o)i=(0,a.K6)(e,i);if(!i)return;let s=0,l=new Set,c=!1;for(let e of i)e.structure||e.getMap().forEach((e,t,o,i)=>{o>=n.doc.content.size||o>=i||!n.doc.content.childCount||(i>n.doc.content.size&&(i=n.doc.content.size),n.doc.content.nodesBetween(o,i,(e,t,o)=>{if(o)return!1;if(!e.attrs.source&&e.textContent.startsWith("{")||c){if(l.has(e.attrs.id))return!1;l.add(e.attrs.id);let o=1;c&&(o=0);let i=0;" "===e.textContent.charAt(1)&&(o=2),"}"===e.textContent.slice(-1)?(i=1," "===e.textContent.slice(-2,-1)&&(i=2),c=!1):c=!0,e.textContent.slice(o,0===i?e.nodeSize:-i)?r.replaceRangeWith(t+1+s,Math.min(t+s+e.nodeSize,r.doc.content.size),n.schema.text(e.textContent.slice(o,0===i?e.nodeSize:-i))):r.delete(t+1+s,t+2+s),r.setNodeMarkup(t+s,void 0,{...e.attrs,source:d.Y1.instruction}),s-=o,s-=i}return!1}))});return r}})},k=e=>{let{enabled:t,inverted:n}=e,r=new o.hs("highlightDialogue");return new o.k_({key:r,appendTransaction(e,o,r){if(!t()||r.doc.content.size<=2)return;let i=e.filter(e=>e.docChanged);if(0===i.length)return;let s=n(),l=r.tr,c=-1,d=-1;for(let e of i)e.mapping.maps.forEach((t,n)=>{t.forEach((t,o)=>{let r=e.mapping.slice(n).map(t,-1),i=e.mapping.slice(n).map(o);c=c<0?r:Math.min(c,r),d=d<0?i:Math.max(d,i)})});if(c<0||d<0)return;d>r.doc.content.size&&(d=r.doc.content.size),c>d&&(c=d);let{pairs:p,nodes:f}=(0,a.Fx)(r,c,d,['"'],s);for(let{start:e,end:t}of f)l.removeMark(e,t,r.schema.marks.dialogue);for(let e of p)l.addMark(e.start,e.end,r.schema.marks.dialogue.create());return l.setMeta("internal",!0),l}})},z=()=>{let e=new o.hs("devTool"),t={update:void 0};return new o.k_({key:e,state:{init(e,o){"debug"===s.OH&&n.e(4291).then(n.t.bind(n,2841,23)).then(e=>{let{createDevTools:n}=e;t.update=n({state:o},{})}).catch(()=>{})},apply(e,n,o,r){t.update?.call(t,e,o,r)}}})},b=()=>{let e=new o.hs("menuLogProbsDecorator"),t={probs:[],contentSize:0};return new o.k_({key:e,state:{init:()=>i.zF.empty,apply:(e,n)=>{let o=[];if(e.getMeta("clearprobs"))return t.probs=[],i.zF.empty;let r=e.getMeta("logprobs");for(let n of(r&&(t.probs=r,t.contentSize=e.doc.content.size),t.probs)){let{start:t,end:r,probability:s}=n,l=Math.min(e.doc.content.size+t,e.doc.content.size),c=Math.min(e.doc.content.size+r,e.doc.content.size);o.push(i.NZ.inline(l,c,{class:`logprobs-color-${Math.floor(30*s)} logprobs-decoration`},{absoluteEnd:c}))}return t.probs?i.zF.create(e.doc,o):n}},props:{decorations(e){return this.getState(e)}}})},x=()=>{let e,t,n=new o.hs("magicWandNodeExpander");return new o.k_({key:n,state:{init:()=>i.zF.empty,apply:(n,o)=>{if(!1===n.getMeta("magicWandOpen"))return i.zF.empty;if(e==n.getMeta("magicWandTarget")&&t==n.getMeta("magicWandHeight")||!(e=n.getMeta("magicWandTarget")))return o;t=n.getMeta("magicWandHeight");let r=[],s=new Set(e.map(e=>Number(e.id)));return n.doc.descendants((e,n)=>{if(e.attrs.id)return s.has(e.attrs.id)?r.push(i.NZ.node(n,n+e.nodeSize,{style:`
                                    height: ${t/s.size}px;
                                    opacity: 0;
                                    transition: height 300ms cubic-bezier(0.22, 1, 0.36, 1);
                                    overflow: hidden;
                                `})):r.push(i.NZ.node(n,n+e.nodeSize,{style:`
                                    opacity: 0.2;
                                `})),!1}),i.zF.create(n.doc,r)}},props:{decorations(e){return this.getState(e)}}})},S=()=>{let e=new o.hs("findResultHighlight"),t={results:[]},n={inner:void 0},r={count:0};return new o.k_({key:e,state:{init:()=>i.zF.empty,apply:(e,o)=>{let s=[];if(e.getMeta("clearfindresults"))return t.results=[],i.zF.empty;let l=e.getMeta("findresults"),c=e.getMeta("selectedfindresult"),a=0;for(let o of(e.doc.descendants(e=>("paragraph"===e.type.name&&a++,!1)),l&&(t.results=l),c&&(n.inner=c),t.results)){let{section:t,offset:r,length:l}=o;-1!==r&&e.doc.descendants((e,o)=>"paragraph"===e.type.name&&(e.attrs.id==t?.id&&s.push(i.NZ.inline(o+r+1,o+r+l+1,{class:`find-result ${n.inner?.section===t&&n.inner?.offset===r?"selected-find-result":""}`})),!1))}return l||a!==r.count?i.zF.create(e.doc,s):o}},props:{decorations(e){return this.getState(e)}}})},v=new Map([["“",{open:'"',close:'"'}],["‘",{open:"'",close:"'"}],["「",{open:"「",close:"」"}],["『",{open:"『",close:"』"}],["【",{open:"【",close:"】"}],["（",{open:"（",close:"）"}],["《",{open:"《",close:"》"}],["〈",{open:"〈",close:"〉"}],["｢",{open:"｢",close:"｣"}],["〝",{open:"〝",close:"〟"}],["〔",{open:"〔",close:"〕"}],['"',{open:'"',close:'"'}],["'",{open:"'",close:"'"}],["(",{open:"(",close:")"}],["[",{open:"[",close:"]"}],["{",{open:"{",close:"}"}],["<",{open:"<",close:">"}]]),C=new o.hs("wrapText"),M=e=>new o.k_({key:C,state:{init:()=>({triggerMap:e}),apply:(e,t)=>t},props:{handleKeyPress(t,n){let{state:r}=t,{selection:i}=r;if(i.empty)return!1;let s=n.key,l=e.get(s);if(!l)return!1;n.preventDefault();let{from:c,to:a}=i,d=r.tr;if("{"===s){let{doc:e}=r,n=e.textBetween(c-1,c),o=e.textBetween(a,a+1);if("["===n&&"]"===o)return d.delete(a,a+1).delete(c-1,c),t.dispatch(d),!0}else if("["===s){let{doc:e}=r,n=e.textBetween(c-1,c),o=e.textBetween(a,a+1);if("{"===n&&"}"===o)return d.delete(a,a+1).delete(c-1,c),t.dispatch(d),!0}d.insertText(l.close,a).insertText(l.open,c);let p=c+l.open.length,f=a+l.open.length;return d.setSelection(o.U3.create(d.doc,p,f)),t.dispatch(d),!0}}}),T=e=>{let t=new o.hs("keyReplacement"),n=t=>e.rules.reduce((e,t)=>e.replaceAll(t.from,t.to),t);return new o.k_({key:t,props:{handleTextInput(e,t,o,r){let i=n(r);return i!==r&&(e.dispatch(e.state.tr.insertText(i,t,o)),!0)},handlePaste(e,t,o){if(!t.clipboardData)return!1;let r=t.clipboardData.getData("text/plain");if(!r)return!1;let i=n(r);if(i===r)return!1;let{from:s,to:l}=e.state.selection;return e.dispatch(e.state.tr.replaceWith(s,l,e.state.schema.text(i))),!0}}})},I=()=>new o.k_({key:new o.hs("decorateInstructionBlock"),props:{decorations(e){let{doc:t}=e,n=[],o=[];t.descendants((e,t)=>{"paragraph"===e.type.name&&o.push({node:e,pos:t,size:e.nodeSize})});let r=!1;for(let e=0;e<o.length;e++){let{node:t,pos:s,size:l}=o[e],c=t.attrs.source===d.Y1.instruction,a=o[e+1]?.node?.attrs.source===d.Y1.instruction;c&&r&&a?n.push(i.NZ.node(s,s+l,{class:"instruction-block-mid"})):c&&r?n.push(i.NZ.node(s,s+l,{class:"instruction-block-end"})):c&&a&&n.push(i.NZ.node(s,s+l,{class:"instruction-block-start"})),r=c}return i.zF.create(t,n)}}})},93040:(e,t,n)=>{n.d(t,{$f:()=>C,Ou:()=>v,Qv:()=>g,Sd:()=>m,UI:()=>x,Ub:()=>f,Z1:()=>w,_e:()=>y,aw:()=>b,eT:()=>h,ec:()=>M,ic:()=>u,iz:()=>k,st:()=>T});var o=n(6084),r=n(72191),i=n(49882),s=n(71928);function l(e,t,n){for(let o=e;o;o="start"==t?o.firstChild:o.lastChild){if(o.isTextblock)return!0;if(n&&1!=o.childCount)break}return!1}function c(e,t,n){let c=t.nodeBefore,a=t.nodeAfter;if(!c||!a)return(0,s.vV)(`undefined before or after: ${c} ${a} in state ${e}`),!1;if(c.type.spec.isolating||a.type.spec.isolating)return!1;if(function(e,t,n){let r=t.nodeBefore,i=t.nodeAfter,s=t.index();return!!r&&!!i&&!!r.type.compatibleContent(i.type)&&(0===r.content.size&&t.parent.canReplace(s-1,s)?(n&&n(e.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),!0):!!t.parent.canReplace(s,s+1)&&!!(i.isTextblock||(0,o.n9)(e.doc,t.pos))&&(n&&n(e.tr.clearIncompatible(t.pos,r.type,r.contentMatchAt(r.childCount)).join(t.pos).scrollIntoView()),!0))}(e,t,n))return!0;let d=t.parent.canReplace(t.index(),t.index()+1);if(d){let i=c.contentMatchAt(c.childCount),s=i.findWrapping(a.type);if(s&&i.matchType(s[0]||a.type)?.validEnd){if(n){let i=t.pos+a.nodeSize,l=r.FK.empty;for(let e=s.length-1;e>=0;e--)l=r.FK.from(s[e].create(void 0,l));l=r.FK.from(c.copy(l));let d=e.tr.step(new o.Wg(t.pos-1,i,t.pos,i,new r.Ji(l,1,0),s.length,!0)),p=i+2*s.length;(0,o.n9)(d.doc,p)&&d.join(p),n(d.scrollIntoView())}return!0}}let p=i.LN.findFrom(t,1),f=p&&p.$from.blockRange(p.$to),u=f&&(0,o.jP)(f);if(f&&void 0!=u&&u>=t.depth)return n&&n(e.tr.lift(f,u).scrollIntoView()),!0;if(d&&l(a,"start",!0)&&l(c,"end")){let i=c,s=[];for(;s.push(i),!i.isTextblock&&i.lastChild;)i=i.lastChild;let l=1,d=a;for(;!d.isTextblock&&d.firstChild;d=d.firstChild)l++;if(i.canReplace(i.childCount,i.childCount,d.content)){if(n){let i=r.FK.empty;for(let e=s.length-1;e>=0;e--)i=r.FK.from(s[e].copy(i));n(e.tr.step(new o.Wg(t.pos-s.length,t.pos+a.nodeSize,t.pos+l,t.pos+a.nodeSize-l,new r.Ji(i,s.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function a(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}}function d(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}}function p(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}}function f(e,t){return t&&t(e.tr.setSelection(new i.i5(e.doc))),!0}function u(e,t){return!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0)}function h(e,t,n){if(!(e.selection instanceof i.U3))return!1;let{$cursor:a}=e.selection;if(!a||(n?!n.endOfTextblock("forward",e):a.parentOffset<a.parent.content.size))return!1;let p=d(a);if(!p)return!1;let f=p.nodeAfter;if(!f)return(0,s.vV)(`no node after ${JSON.stringify(p)}`),!1;if(c(e,p,t))return!0;if(0===a.parent.content.size&&(l(f,"start")||i.nh.isSelectable(f))){let n=(0,o.$L)(e.doc,a.before(),a.after(),r.Ji.empty);if(n&&n.slice.size<n.to-n.from){if(t){let o=e.tr.step(n),r=l(f,"start")?i.LN.findFrom(o.doc.resolve(o.mapping.map(p.pos)),1):i.nh.create(o.doc,o.mapping.map(p.pos));r?o.setSelection(r):(0,s.vV)("could not set selection"),t(o.scrollIntoView())}return!0}}return!!f.isAtom&&p.depth==a.depth-1&&(t&&t(e.tr.delete(p.pos,p.pos+f.nodeSize).scrollIntoView()),!0)}function g(e,t,n){if(!(e.selection instanceof i.U3))return!1;let{$cursor:d}=e.selection;if(!d||(n?!n.endOfTextblock("backward",e):d.parentOffset>0))return!1;let p=a(d);if(!p){let n=d.blockRange();if(!n)return!1;let r=n&&(0,o.jP)(n);return void 0!=r&&(t&&t(e.tr.lift(n,r).scrollIntoView()),!0)}let f=p.nodeBefore;if(!f)return(0,s.vV)(`no node before ${JSON.stringify(p)}`),!1;if(!f.type.spec.isolating&&c(e,p,t))return!0;if(0===d.parent.content.size&&(l(f,"end")||i.nh.isSelectable(f))){let n=(0,o.$L)(e.doc,d.before(),d.after(),r.Ji.empty);if(n&&n.slice.size<n.to-n.from){if(t){let o=e.tr.step(n),r=l(f,"end")?i.LN.findFrom(o.doc.resolve(o.mapping.map(p.pos,-1)),-1):i.nh.create(o.doc,p.pos-f.nodeSize);r?o.setSelection(r):(0,s.vV)("could not set selection"),t(o.scrollIntoView())}return!0}}return!!f.isAtom&&p.depth==d.depth-1&&(t&&t(e.tr.delete(p.pos-f.nodeSize,p.pos).scrollIntoView()),!0)}function m(e,t,n){let{$head:o,empty:r}=e.selection,s=o;if(!r)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size)return!1;s=d(o)}let l=s&&s.nodeAfter;return!!s&&!!l&&!!i.nh.isSelectable(l)&&(t&&t(e.tr.setSelection(i.nh.create(e.doc,s.pos)).scrollIntoView()),!0)}function y(e,t,n){let{$head:o,empty:r}=e.selection,s=o;if(!r)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):o.parentOffset>0)return!1;s=a(o)}let l=s&&s.nodeBefore;return!!s&&!!l&&!!i.nh.isSelectable(l)&&(t&&t(e.tr.setSelection(i.nh.create(e.doc,s.pos-l.nodeSize)).scrollIntoView()),!0)}function w(e,t){let n=e.selection,{$from:o,$to:r}=n;if(n instanceof i.i5||o.parent.inlineContent||r.parent.inlineContent)return!1;let l=p(r.parent.contentMatchAt(r.indexAfter()));if(!l||!l.isTextblock)return!1;if(t){let n=(!o.parentOffset&&r.index()<r.parent.childCount?o:r).pos,c=l.createAndFill();if(!c)return(0,s.vV)("create and fill failed",!1),!1;let a=e.tr.insert(n,c);a.setSelection(i.U3.create(a.doc,n+1)),t(a.scrollIntoView())}return!0}function k(e,t){if(!(e.selection instanceof i.U3))return!1;let{$cursor:n}=e.selection;if(!n||n.parent.content.size>0)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if((0,o.zy)(e.doc,r))return t&&t(e.tr.split(r).scrollIntoView()),!0}let r=n.blockRange();if(!r)return!1;let s=r&&(0,o.jP)(r);return void 0!=s&&(t&&t(e.tr.lift(r,s).scrollIntoView()),!0)}function z(e){e.type.defaultAttrs.id&&delete e.type.defaultAttrs.id,e.attrs?.id&&delete e.attrs.id}function b(e,t){let{$from:n,$to:r}=e.selection;if(e.selection instanceof i.nh&&e.selection.node.isBlock){let{type:r,attrs:i}=e.selection.node;return z({type:r,attrs:i}),!!n.parentOffset&&!!(0,o.zy)(e.doc,n.pos)&&(t&&t(e.tr.split(n.pos,void 0,[{type:r,attrs:i}]).scrollIntoView()),!0)}if(!n.parent.isBlock)return!1;if(t){let s=r.parentOffset==r.parent.content.size,l=e.tr;(e.selection instanceof i.U3||e.selection instanceof i.i5)&&l.deleteSelection();let c=0==n.depth?void 0:p(n.node(-1).contentMatchAt(n.indexAfter(-1))),a=c?[{type:c}]:void 0;if(a)for(let e of a)z(e);let d=(0,o.zy)(l.doc,l.mapping.map(n.pos),1,a);if(c&&!a&&!d&&(0,o.zy)(l.doc,l.mapping.map(n.pos),1,c&&[{type:c}])&&(a=[{type:c}],d=!0),d&&(l.split(l.mapping.map(n.pos),1,a),!s&&!n.parentOffset&&n.parent.type!=c)){let e=l.mapping.map(n.before()),t=l.doc.resolve(e);c&&n.node(-1).canReplaceWith(t.index(),t.index()+1,c)&&l.setNodeMarkup(l.mapping.map(n.before()),c)}t(l.scrollIntoView())}return!0}function x(e,t){let{$from:n,$to:r}=e.selection;if(e.selection instanceof i.nh&&e.selection.node.isBlock){let{type:r,attrs:i}=e.selection.node;return z({type:r,attrs:i}),!!n.parentOffset&&!!(0,o.zy)(e.doc,n.pos)&&(t&&t(e.tr.split(n.pos,void 0,[{type:r,attrs:i}]).scrollIntoView()),!0)}if(!n.parent.isBlock)return!1;if(t){let s=r.parentOffset==r.parent.content.size,l=e.tr;(e.selection instanceof i.U3||e.selection instanceof i.i5)&&l.deleteSelection();let c=0==n.depth?void 0:p(n.node(-1).contentMatchAt(n.indexAfter(-1))),a=n.parent.attrs.source,d=c?[{type:c,attrs:{source:a}}]:void 0;if(d)for(let e of d)z(e);let f=(0,o.zy)(l.doc,l.mapping.map(n.pos),1,d);if(c&&!d&&!f&&(0,o.zy)(l.doc,l.mapping.map(n.pos),1,c&&[{type:c}])&&(d=[{type:c,attrs:{source:a}}],f=!0),f&&(l.split(l.mapping.map(n.pos),1,d),!s&&!n.parentOffset&&n.parent.type!=c)){let e=l.mapping.map(n.before()),t=l.doc.resolve(e);c&&n.node(-1).canReplaceWith(t.index(),t.index()+1,c)&&l.setNodeMarkup(l.mapping.map(n.before()),c)}t(l.scrollIntoView())}return!0}function S(e){return(t,n)=>{let o=t.selection,r=e<0?o.$from:o.$to,s=r.depth;for(;r.node(s).isInline;){if(!s)return!1;s--}return!!r.node(s).isTextblock&&(n&&n(t.tr.setSelection(i.U3.create(t.doc,e<0?r.start(s):r.end(s)))),!0)}}function v(e,t){let{$from:n,$to:o}=e.selection;if(n!==o||4!==e.doc.nodeSize)return!1;if(t){let o=e.tr;n.pos>0&&o.delete(0,n.pos),o.setNodeAttribute(0,"source",null),t(o)}return!0}let C=S(-1),M=S(1);function T(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(e,n,o)=>{for(let r of t)if(r(e,n,o))return!0;return!1}}}}]);