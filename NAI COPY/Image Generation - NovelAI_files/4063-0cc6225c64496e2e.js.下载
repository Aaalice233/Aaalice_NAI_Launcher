!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8eb45d92-1a4b-4094-8c9a-72fe6c8ddcc5",e._sentryDebugIdIdentifier="sentry-dbid-8eb45d92-1a4b-4094-8c9a-72fe6c8ddcc5")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4063],{274:(e,t,i)=>{i.d(t,{J:()=>r});var n=i(57259),o=i(57500);async function r(e,t,i,r,s,l,c,a,d,g){let{start:h,end:p,text:m}=function(e,t,i,r,s,l,c){let a=0,d=0,g="",h=!1;for(let[p,{text:m,prefix:f,suffix:x,textWithFormatting:u,indexMap:b,formattingAtIndex:y}]of e.entries()){let e=(0,o.Gd)(l)?u??m:m,w=i,v=s;if((0,o.Gd)(l)&&b&&u){if(p===t){let e=m.length-i,t=b.get(e);t&&(w=u.length-t)}if(p===r){let e=m.length-s,t=b.get(e);t&&(v=u.length-t)}}if(p<t){a+=f?.length??0,g+=f??"",a+=e.length,g+=e,a+=x?.length??0,g+=x??"",g+="\n",a+=1;continue}if(p===t){a+=f?.length??0,g+=f??"";let t=0!==w?e.slice(0,-w):e;if(g+=t,a+=t.length,y&&c){let e=m.length-i,t=y.get(e);if(t){let i=[...t].reverse(),o="";for(let t of i)0!==e&&y.get(e-1)?.includes(t)?o+=n.B[t].end:(g=g.slice(0,-n.B[t].start.length),a-=n.B[t].start.length);g+=o,a+=o.length}}if(0===w&&(g+=x??"",a+=x?.length??0),d=a,p===r){let t=e.slice(e.length-w,e.length-v);if(g+=t,d+=t.length,y&&v>0&&c){let e=m.length-s,t=y.get(e);if(t)for(let i of[...t].reverse())0!==e&&y.get(e-1)?.includes(i)?d+=n.B[i].end.length:d-=n.B[i].start.length}h=!0}else{let t=e.slice(e.length-w);g+=t,d+=t.length}g+="\n",h||(d+=1);continue}if(p>t&&p<r){g+=f??"",g+=e,g+=x??"",g+="\n",d+=f?.length??0,d+=e.length,d+=x?.length??0,d+=1;continue}if(p===r){g+=f??"",d+=f?.length??0;let t=0!==v?e.slice(0,-v):e;if(g+=t,d+=t.length,y&&v>0){let e=m.length-s,t=y.get(e);if(t){let i=[...t].reverse(),o="";for(let t of i)if(0!==e&&y.get(e-1)?.includes(t))o+=n.B[t].end;else{let e=n.B[t].start.length;g.endsWith(n.B[t].start)&&(g=g.slice(0,-e),d-=e)}g+=o,d+=o.length}}g+=e.slice(-v),0===v&&(g+=x??""),g+="\n",h=!0;continue}if(p>r){g+=f??"",g+=e,g+=x??"",g+="\n";continue}}return{start:a,end:d,text:g=g.slice(0,-1)}}(e,t,i,r,s,l,c);if(e.some(e=>void 0===e.sectionId)||!d)return{start:h,end:p,text:m};let f=m.slice(0,h),x=m.slice(h),u=f.split("\n"),b=[];for(let t=0;t<u.length&&t<e.length;t++){let i=e[t];b.push({sectionId:i.sectionId,text:u[t]})}let y=(await d({continuityId:g||"",reason:a,sections:b})).map(e=>e.text).join("\n"),w=y.length,v=w+(p-h);return{start:w,end:v,text:y+x}}},22798:(e,t,i)=>{i.d(t,{$z:()=>g,Ez:()=>w,LG:()=>z,LU:()=>k,RA:()=>f,TR:()=>p,UV:()=>v,Vl:()=>u,Xh:()=>b,_E:()=>y,aV:()=>A,cC:()=>I,iG:()=>x,ni:()=>m,sc:()=>h,tw:()=>C,xh:()=>j});var n=i(55805),o=i(82841),r=i(89077),s=i(92704),l=i(29718),c=i(22577),a=i(44788),d=i(27647);let g=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-0"})(["position:relative;",""],e=>e.mode===d.JC.adventure&&(0,n.AH)(["border:1px solid ",";padding-left:50px;&::before{content:'';background:",";width:50px;height:100%;position:absolute;left:0;border-right:1px solid ",";}&::after{content:'';background-position:center;background-size:contain;background-repeat:no-repeat;mask-repeat:no-repeat;mask-size:contain;mask-position:center;background-color:",";mask-image:url(",");width:20px;height:20px;position:absolute;left:15px;top:15px;opacity:0.9;}"],e.theme.colors.bg3,e.theme.colors.bg1,e.theme.colors.bg3,e.theme.colors.textMain,e.inputModeIcon)),h=n.Ay.textarea.withConfig({componentId:"sc-6cbcc1c5-1"})(["background:",";flex:0;min-height:80px;min-height:80px;resize:none;font-size:1rem;"],e=>e.theme.colors.bg1),p=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-2"})(["display:flex;flex-direction:row;flex-wrap:wrap;background:",";font-size:0.8rem;border-top:1px solid ",";padding:5px;& > *:not(:last-child){margin-right:10px;}"],e=>e.theme.colors.bg1,e=>e.theme.colors.bg3),m=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-3"})(["pointer-events:",";"],e=>e.visible?"normal":"none"),f=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-4"})(["opacity:",";position:relative;transition:opacity 0.32s ease-in-out,margin-bottom 0.32s ease-in-out;display:flex;flex-direction:",";",";"],e=>+!!e.visible,e=>e.reversed?"column-reverse":"column",e=>e.reversed?(0,n.AH)(["& > :not(:first-child){margin-bottom:0.5rem;}"]):(0,n.AH)(["& > :not(:last-child){margin-bottom:0.5rem;}"])),x=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-5"})(["display:flex;flex-direction:row;user-select:none;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;@media (max-width:","){margin-bottom:0px;}"],e=>e.theme.breakpoints.mobile),u=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-6"})(["display:flex;flex-direction:row;user-select:none;gap:8px;align-items:flex-end;flex-wrap:wrap;"]),b=(0,n.Ay)(s.Int).withConfig({componentId:"sc-6cbcc1c5-7"})(["margin-top:-0.1em;mask-image:url(",");width:0.5em;"],e=>e.up?c.A.src:l.A.src),y=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-8"})(["align-items:center;color:",";display:flex;font-size:1rem;flex:1;&:not(:empty){@media (max-width:","){margin-bottom:0.5rem;}}&:empty{margin-bottom:0;margin-top:0;}",""],e=>e.theme.colors.warning,e=>e.theme.breakpoints.mobile,e=>e.visible?null:(0,n.AH)(["animation:"," 0.3s forwards;"],o.pi)),w=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-9"})(["width:fit-content;flex-shrink:0;display:flex;gap:1px;"]),v=(0,n.Ay)(r.$n).withConfig({componentId:"sc-6cbcc1c5-10"})(["display:flex;flex-direction:row;justify-content:flex-start;flex-wrap:wrap;gap:15px;width:100%;font-size:1em;line-height:1.5em;background:",";position:relative;padding-right:25px;&::after{content:'';position:absolute;right:0;mask-image:url(",");mask-repeat:no-repeat;mask-size:contain;mask-position:center;background-color:",";height:16px;width:16px;margin-right:5px;display:",";opacity:0.3;}> div{margin:0;overflow:hidden;padding:0;align-items:center;display:flex;flex-direction:row;text-align:start;div:first-child{width:10px;margin-right:10px;background-color:",";flex-shrink:0;}div:last-child{text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;}&:nth-child(2n){margin-left:10px;}}"],e=>(e.preferred,e.theme.colors.bg1),a.A.src,e=>e.theme.colors.textHeadings,e=>e.preferred?"block":"none",e=>e.theme.colors.textHeadings),k=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-11"})(["background-color:",";max-height:40vh;overflow-y:auto;bottom:100%;display:flex;flex-direction:column-reverse;left:0;position:absolute;width:100%;box-shadow:0 0 3px 0 ",";z-index:1;"],e=>e.theme.colors.bg1,e=>e.theme.colors.bg3),I=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-12"})(["background-color:",";display:flex;flex-direction:column;width:100%;"],e=>e.theme.colors.bg1),C=n.Ay.span.withConfig({componentId:"sc-6cbcc1c5-13"})(["@media (max-width:800px){display:",";}@media (max-width:500px){display:none;}"],e=>e.show?"block":"none"),j=n.Ay.div.withConfig({componentId:"sc-6cbcc1c5-14"})(["display:",";@media (max-width:800px){display:block;}background-color:",";mask-image:url(",");mask-repeat:no-repeat;mask-size:contain;-webkit-mask-position:center center;mask-position:center center;width:1em;margin-top:0;height:1em;color-adjust:exact;@media (forced-colors:active){forced-color-adjust:none;}"],e=>e.swap?"none":"block",e=>e.theme.colors.textMain,e=>e.icon??""),A=(0,n.Ay)(r.$n).withConfig({componentId:"sc-6cbcc1c5-15"})(["padding:",";@media (max-width:35000px){padding:0.7em 0.9em;}gap:8px;line-height:1em;margin-bottom:0.2em;font-size:0.875em;font-weight:600;height:2.5rem;display:flex;position:relative;color:",";",";&:disabled > ","{background-color:",";}> ","{background-color:",";}"],e=>e.icon?"0.9em 1em":"0.9em 0.9em",e=>e.highlight?e.theme.colors.textHeadings:e.theme.colors.textMain,e=>e.highlight?`border: 1px solid ${e.theme.colors.textHeadings};`:"",j,e=>e.theme.colors.textDisabled,j,e=>e.highlight?e.theme.colors.textHeadings:e.theme.colors.textMain),z=(0,n.Ay)(r.$n).withConfig({componentId:"sc-6cbcc1c5-16"})(["line-height:1em;margin-bottom:0.2em;font-size:0.875em;font-weight:600;height:2.5rem;padding:0 1em;top:0;position:relative;> div{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;> div{height:6px;}> span{line-height:normal;min-width:0.5em;}}line-height:0px;justify-content:start;flex-direction:column;display:flex;"])},86886:(e,t,i)=>{i.d(t,{A:()=>d});var n=i(69777),o=i(13502),r=i(83389),s=i(79630),l=i(97223),c=i(71928),a=i(2834);function d(e){let t=(0,a.md)(l.NF);return()=>{let i=s.C.stories.get(e),l=s.C.storyContentCache.get(e),a=o.HB.bundle(i,l),d=a.serialize();if((a=o.HB.deserialize(d)).metadata.remoteId=void 0,a.metadata.remoteStoryId=void 0,a.metadata.createdWithNoAccount=void 0,a.content.settings.prefix&&a.content.settings.prefix.includes(":")){let e=t.find(e=>e.id===a.content.settings.prefix);e&&((e=(0,n.iu)(r.Pu,(0,n.lK)(r.Pu,e))).remoteId="",a.content.settings.aiModule=e,a.content.settings.aiModule.remoteId="")}(0,c.MT)(a.serialize(!0),`${a.metadata.title.slice(0,40)} (${new Date().toISOString()}).story`)}}},94063:(e,t,i)=>{i.d(t,{Ay:()=>D,Ck:()=>N,NV:()=>_,_d:()=>$,lW:()=>B,ww:()=>H});var n=i(94458),o=i(69777),r=i(55805),s=i(27481),l=i(68658),c=i(23699),a=i(14723),d=i(79630),g=i(97223),h=i(89077),p=i(19432),m=i(13502),f=i(71928),x=i(83389),u=i(41879),b=i(92704),y=i(97620),w=i(22798),v=i(47644),k=i(84601),I=i(86886),C=i(73484),j=i(2834),A=i(27524),z=i(274),S=i(32139),M=i(88743),T=i(27157);let $=r.Ay.div.withConfig({componentId:"sc-c5a85611-0"})(["display:flex;flex-direction:row;justify-content:left;gap:10px;flex-wrap:wrap;width:100%;"]);function B(e){navigator.clipboard?.writeText(e)}function H(){return void 0!==navigator.clipboard&&void 0!==navigator.clipboard.write}function N(e){return navigator.clipboard.write([new ClipboardItem({"image/png":e})])}function D(e){let t=(0,C.B2)(),i=(0,j.md)(g.Nn),r=(0,j.md)(g.NF),w=d.C.stories.get(e.selectedStory),v=d.C.storyContentCache.get(e.selectedStory),$=(0,I.A)(e.selectedStory),H=async()=>{if(!v||!w)return;let e=v.getStoryParagraphs({textAdventureMarks:(0,A.PV)(v.settings),instructionMarks:!0}),t={sectionId:e[e.length-1]?.sectionId??0,offset:(e[e.length-1]?.text?.length??1)-1},i=(0,M.A)(),n=T.J.get("callOnDocumentConvertedToText"),{text:o}=await (0,z.J)(e,t.sectionId,t.offset,t.sectionId,t.offset,v.settings.model??S.Lk,!1,"export",n,i);(0,f.MT)(o,`${w.title.slice(0,40)} (${new Date().toISOString()}).txt`)},N=async()=>{if(!v||!w)return;let e=m.HB.bundle(w,v),i=e.serialize();if((e=m.HB.deserialize(i)).metadata.remoteId=void 0,e.metadata.remoteStoryId=void 0,v.settings.prefix&&v.settings.prefix.includes(":")){let t=r.find(e=>e.id===v.settings.prefix);t&&((t=(0,y.i)(x.Pu,(0,o.lK)(x.Pu,t))).remoteId="",e.content.settings.aiModule=t,e.content.settings.aiModule.remoteId="")}B(e.serialize()),(0,s.oR)(t.stories.storyCopiedToClipboard)},D=(0,j.Xr)(g.Fr),_=async()=>{v&&w&&(v.document?D({open:!0,start:v.document.getLength(),end:0}):v.story&&D({open:!0,start:0,end:v.getStoryText().length}))},[G,E]=(0,l.useState)(!1);return(0,n.jsxs)(u.wt,{className:"infobar-export",style:{gap:"5px"},children:[(0,n.jsx)("strong",{children:t.stories.exportStory}),(0,n.jsxs)(h.fg,{style:{alignItems:"stretch",marginTop:5},children:[(0,n.jsxs)(h.WM,{style:{flex:"1 1 50%"},centered:!0,onClick:()=>{$()},disabled:void 0===v,children:[(0,n.jsx)(b.GP3,{}),t.stories.toFile]}),(0,n.jsx)(P,{displayToggle:!0,onClick:()=>{E(e=>!e)},active:G,children:(0,n.jsxs)("div",{children:["\xa0",G?(0,n.jsx)(b.Kpk,{}):(0,n.jsx)(b.ZLN,{}),"\xa0"]})})]}),(0,n.jsx)(c.N,{children:G&&(0,n.jsxs)(a.P.div,{initial:{opacity:0,height:0,marginTop:-5},animate:{opacity:1,height:"min-content",marginTop:0},exit:{opacity:0,height:0,marginTop:-5},style:{overflow:"hidden",display:"flex",flexDirection:"column",width:"100%",gap:5},children:[(0,n.jsx)(u.Ye,{style:{gap:"10px"},children:(0,n.jsxs)(h.ur,{style:{flex:"1 1 50%"},centered:!0,onClick:()=>{let t=(0,p.Ql)(e.selectedStory,r);t&&w&&(t.author=(0,k.cv)(i.settings,"penName")??"",(0,f.MT)(t.serialize(!0),`${w.title.slice(0,40)} (${new Date().toISOString()}).scenario`))},disabled:void 0===v,children:[(0,n.jsx)(b.GP3,{}),t.stories.asScenario]})}),(0,n.jsx)(u.Ye,{style:{gap:"10px"},children:(0,n.jsxs)(h.ur,{style:{flex:"1 1 50%"},centered:!0,onClick:()=>{H()},disabled:void 0===v,children:[(0,n.jsx)(b.GP3,{}),t.stories.asPlaintext]})}),(0,n.jsx)(u.Ye,{style:{gap:"10px"},children:(0,n.jsxs)(h.ur,{style:{flex:"1 1 100%"},centered:!0,onClick:()=>{N()},disabled:void 0===v,children:[(0,n.jsx)(b.iNo,{style:{width:12}}),t.stories.toClipboard]})}),(0,n.jsx)(u.Ye,{style:{gap:"10px"},children:(0,n.jsxs)(h.ur,{style:{flex:"1 1 100%"},centered:!0,onClick:()=>{_()},disabled:void 0===v,children:[(0,n.jsx)(b.$mk,{}),t.stories.asImage]})})]},"a")})]})}let P=(0,r.Ay)(w.LG).withConfig({componentId:"sc-c5a85611-1"})(["background-color:",";margin:0 !important;height:auto;&:hover,&:focus{background:",";}"],e=>e.active?e.theme.colors.bg2:e.theme.colors.bg3,e=>(0,v.jh)(.97,e.active?e.theme.colors.bg2:e.theme.colors.bg3,e.theme.colors.textMain));function _(e){return e.story?(0,n.jsx)(h.uW,{onClick:()=>{(()=>{if(!e.story)return;let t=e.story;(0,f.MT)(t.serialize(!0),`${t.metadata.title.slice(0,40)} (${new Date().toISOString()}).story`)})()},children:"Export"}):(0,n.jsx)(n.Fragment,{})}}}]);