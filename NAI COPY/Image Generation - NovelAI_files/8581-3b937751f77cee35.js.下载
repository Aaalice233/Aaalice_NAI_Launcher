!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a61e4745-168d-44c3-9ea2-4384f33aac5c",e._sentryDebugIdIdentifier="sentry-dbid-a61e4745-168d-44c3-9ea2-4384f33aac5c")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8581],{48581:(e,t,n)=>{n.r(t),n.d(t,{ModalSignUp:()=>z,default:()=>J});var r=n(94458),i=n(89441),s=n(68658),a=n(20851),o=n.n(a),l=n(29415),d=n.n(l),c=n(21681),h=n.n(c),u=n(38474),m=n(26907),x=n(88587),g=n(48370),p=n(92704),y=n(41963),f=n(53875),j=n(89077),v=n(17309),w=n(13502),k=n(79630),F=n(71928),b=n(83513),C=n(84601),S=n(36814),G=n(73484),_=n(97223),A=n(74700),D=n(55805),B=n(58286),I=n(2834),N=n(52746),R=n(81336),E=n(17391),T=n(97271),H=n(98883),L=n(19058),K=n(14666),O=n(39979),U=n(82685),q=n(2585);function J(){let e=(0,u.useRouter)(),t=(0,s.useMemo)(()=>(0,r.jsx)(q.A,{forLogin:!0}),[]);return(0,r.jsxs)(m.j$,{children:[t,(0,r.jsx)(m.Ql,{}),(0,r.jsx)($,{giftkey:e.query.giftkey?e.query.giftkey:void 0})]})}function $(e){let t=(0,G.B2)(),n=(0,u.useRouter)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h(),{children:(0,r.jsx)("title",{children:"Register - NovelAI"})}),(0,r.jsx)(m.mX,{children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",height:"100%",width:"100%"},children:[(0,r.jsxs)(m.nR,{children:[(0,r.jsxs)(d(),{href:"/",passHref:!0,scroll:!1,children:[(0,r.jsx)(p.A60,{}),t.common.back]}),(0,r.jsx)(S.J,{shouldSave:!1}),(0,r.jsx)(d(),{href:"/login",legacyBehavior:!0,children:t.general.logIn})]}),(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%",minHeight:"0",position:"relative",alignItems:"center",justifyContent:"center",flex:"1 1 0"},children:(0,r.jsx)("div",{style:{width:"100%",maxHeight:"100%",position:"absolute",overflowY:"auto",display:"flex",justifyContent:"center"},children:(0,r.jsxs)("div",{style:{width:"100%",maxWidth:"290px",minHeight:"0"},children:[(0,r.jsxs)(m.FJ,{children:[(0,r.jsx)("div",{children:t.general.signUp}),(0,r.jsxs)("div",{children:[t.authFormGeneral.getStarted,"."]})]}),(0,r.jsx)(W,{giftkey:e.giftkey,onRegister:(e,t)=>{n.push("/confirm?trial="+t)}}),(0,r.jsx)("div",{style:{height:"20px"}})]})})})]})})]})}function W(e){let t=(0,G.B2)(),a=(0,I.md)(_.Nn),{capture:l}=(0,b.A)(),d=(0,u.useRouter)(),[c,h]=(0,s.useState)(""),[S,D]=(0,s.useState)(""),[N,R]=(0,s.useState)(""),[E,T]=(0,s.useState)(""),[H,L]=(0,s.useState)(!1),[K,q]=(0,s.useState)(""),[J,$]=(0,s.useState)(!0),[W,z]=(0,s.useState)(!0),V=(0,I.Xr)(_.hO);(0,s.useEffect)(()=>{!E&&e.giftkey&&(T(e.giftkey),L(!0))},[e.giftkey]);let M=async r=>{r?.preventDefault();let s=c.toLowerCase().trim();if(!s||!S)return void q(t.authFormGeneral.emailPasswordEmptyWarning);if(S!==N)return void q(t.authFormGeneral.passwordsDontMatch);if(!s.includes("@")||s.length<=3)return void q(t.authFormGeneral.emailMustBeEmail);if(S.length<8)return void q(t.authFormGeneral.passwordTooShort);$(!1),q(""),await o().ready,localStorage.removeItem("session");try{let r=function(n){let r,d=o().crypto_pwhash(64,new Uint8Array(i.Buffer.from(S)),o().crypto_generichash(o().crypto_pwhash_SALTBYTES,S.slice(0,6)+s+"novelai_data_access_key"),2,2e6,o().crypto_pwhash_ALG_ARGON2ID13,"base64").slice(0,64),c=o().crypto_pwhash(128,new Uint8Array(i.Buffer.from(S)),o().crypto_generichash(o().crypto_pwhash_SALTBYTES,S.slice(0,6)+s+"novelai_data_encryption_key"),2,2e6,o().crypto_pwhash_ALG_ARGON2ID13,"base64"),h=(0,v.Lg)("noAccountSettings"),u=(0,C.cv)(a.settings,"uiLanguage");try{h&&(r=JSON.parse(h))}catch(e){(0,F.vV)("Error in register, could not parse localSettingsString",!1,e)}(0,g.Pk)(d,c,n,s,E,u,W).register().then(async t=>{let{auth_token:n,canUseTrial:i}=t,a=new f.KJ(n,c);r&&(a.settings=r,a.settings.remoteDefault=!0,(0,y.c7)(a).saveSettings(a.settings),(0,v.$1)("noAccountSettings"));let{stories:o}=await (0,y.c7)(a).getStories();k.C.keystore.create(c);try{for(let e of o)if(e.createdWithNoAccount){e.createdWithNoAccount=!1,e.remote=!0;let t=await (0,y.c7)(a).getStoryContent(e);await (0,y.c7)(a).saveStory(w.HB.bundle(e,t),!0)}}catch(e){(0,F.vV)(e)}l("account:created",{location:"register",usedGiftKey:E&&""!==E,newsLetterConsentGiven:W}),(0,B.S)(),V(s),e.onRegister?.(a,i)}).catch(e=>{`${e}`.includes("Incorrect access key")?q(t.authFormGeneral.accountAlreadyExists):q(e),$(!0)})};if(!n.g.window)return;if(x.H3){if(!await (0,F.Ur)()){alert(G.G6.value.authFormGeneral.recaptchaNotLoaded),d.push("/login");return}let e=n.g.window.grecaptcha.enterprise;e.ready(function(){e.execute(x.H3,{action:"REGISTRATION"}).then(r).catch(e=>{`${e}`.includes("Incorrect access key")?q(t.authFormGeneral.accountAlreadyExists):q(e),$(!0)})})}else r("placeholder")}catch(e){`${e}`.includes("Incorrect access key")?q(t.authFormGeneral.accountAlreadyExists):q(e),$(!0)}};function P(e){"Enter"===e.key&&""!==c&&""!==S&&""!==N&&M()}return(0,O.m)(),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:(0,r.jsx)("label",{htmlFor:"email",children:t.authFormGeneral.email})}),(0,r.jsx)(m.D0,{id:"email",value:c,disabled:!J,onChange:e=>h(e.target.value),onKeyDown:P,type:"email",autoComplete:"email",required:!0,style:{marginBottom:10}}),(0,r.jsx)("div",{children:(0,r.jsx)("label",{htmlFor:"password",children:t.general.password})}),(0,r.jsx)(m.D0,{id:"password",value:S,disabled:!J,onChange:e=>D(e.target.value),onKeyDown:P,type:"password",autoComplete:"new-password",required:!0,style:{marginBottom:10}}),(0,r.jsx)("div",{children:(0,r.jsx)("label",{htmlFor:"password2",children:t.authFormGeneral.repeatPassword})}),(0,r.jsx)(m.D0,{id:"password2",value:N,disabled:!J,onChange:e=>R(e.target.value),onKeyDown:P,type:"password",autoComplete:"new-password",required:!0}),"production"!==x.OH&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:(0,r.jsx)("label",{htmlFor:"giftKey",children:(0,r.jsxs)(j.Dp,{onClick:e=>{L(e=>!e),e.preventDefault(),e.stopPropagation()},style:{cursor:"pointer",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%"},"aria-label":t.authFormGeneral.hideOrExpandGiftKey,children:[t.common.giftKey," ",t.common.optional," ",H?(0,r.jsx)(p.Kpk,{}):(0,r.jsx)(p.ZLN,{})]})})}),H?(0,r.jsx)(m.D0,{id:"giftKey",value:E,disabled:!J,onChange:e=>T(e.target.value),onKeyDown:P,type:"text",style:{marginBottom:10}}):(0,r.jsx)("div",{style:{marginBottom:"20px"}}),(0,r.jsx)("div",{style:{marginBottom:"20px"}})]}),(0,r.jsx)(Y,{children:(0,r.jsx)(A.Ay,{value:W,setValue:z,disabled:!J,label:t.authFormGeneral.marketingEmails,alternate:!0})}),(0,r.jsx)(m.XT,{type:"submit",value:J?t.authFormGeneral.startCreating:t.general.loading,disabled:!J,onClick:M}),(0,r.jsx)(U.X,{height:10}),(0,r.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,r.jsx)("div",{style:{fontSize:"1.25rem",fontWeight:"bold"},children:t.common.or}),(0,r.jsx)(U.X,{height:10}),(0,r.jsx)("div",{style:{height:"40px"},className:"google_login_button"})]}),K?(0,r.jsx)(m.Qd,{children:`${K}`}):(0,r.jsx)(r.Fragment,{}),(0,r.jsxs)(m.PE,{children:[(0,r.jsxs)(m.dY,{children:[(0,r.jsxs)("span",{children:[t.general.note.toUpperCase()," "]}),t.authFormGeneral.credentialsSub]}),(0,r.jsxs)("p",{children:[t.authFormGeneral.naiTermsNote[0],(0,r.jsx)("a",{href:"./terms/",target:"_blank",children:t.authFormGeneral.naiTermsNote[1]}),t.authFormGeneral.naiTermsNote[2]]}),(0,r.jsxs)("p",{children:[t.authFormGeneral.googleTermsNote[0],(0,r.jsxs)("a",{href:"https://policies.google.com/privacy",target:"_blank",rel:"noreferrer",children:[" ",t.authFormGeneral.googleTermsNote[1]]})," ",t.authFormGeneral.googleTermsNote[2],(0,r.jsxs)("a",{href:"https://policies.google.com/terms",target:"_blank",rel:"noreferrer",children:[" ",t.authFormGeneral.googleTermsNote[3]]})," ",t.authFormGeneral.googleTermsNote[4]]})]})]})}let Y=D.Ay.div.withConfig({componentId:"sc-9d47cae6-0"})(["> label > div{flex-wrap:nowrap !important;align-items:center !important;gap:20px !important;}"]);function z(e){let[t,n]=(0,I.fp)(_.Nn),i=(0,G.B2)(),[a,o]=(0,I.fp)(_.Ak),[l,d]=(0,I.fp)(_.Hw),{fetchTrialActionCount:c}=(0,H.R9)(),[h,x]=(0,s.useState)("text"===e.page),[p,y]=(0,s.useState)(!0),[v,w]=(0,I.fp)(_.S5),b=(0,u.useRouter)();(0,s.useEffect)(()=>{x("/stories"===b.pathname)},[b.pathname]);let[S,A]=(0,s.useState)("image"===e.page),[D,B]=(0,s.useState)("text"===e.page);(0,s.useEffect)(()=>{b.isReady&&(A(b.pathname.includes("/image")),B(b.pathname.includes("/stories")))},[b.isReady,b.pathname]);let O=(0,E.w)(h),U=async(e,t)=>{w(!0),y(t??!0);let n=await (0,g.zH)("",e.encryption_key,e.auth_token).login();(e=new f.KJ(e.auth_token,e.encryption_key)).subscription=n.subscription??new f.Bx,e.settings=n.settings??new C.tl,e.authenticated=n.session.authenticated,e.priority=n.priority??new f.Wl,e.information=n.information??new f._C,e.keystoreReady=n.session.keystoreReady,e.hasKeystore=n.session.hasKeystore,k.C.keystore=n.session.keystore,await O(e,!0),w(!1)},q=async e=>{w(!0);let r=async()=>{try{let e=await (0,g.kt)(t.auth_token).request();e.emailVerified&&(await c(),n(t=>({...t,information:e})),o(!1),w(!1))}catch(e){(0,F.vV)(e)}};(0,g.Rr)(e,(0,C.cv)(t.settings,"uiLanguage")).request().then(()=>{r()})};return(0,r.jsx)(N.A,{type:N.q.Large,isOpen:a,shouldCloseOnOverlayClick:!0,onRequestClose:()=>o(!1),style:{justifyContent:"flex-end"},children:(0,r.jsxs)(V,{children:[(0,r.jsx)(R.J,{onClick:()=>o(!1),children:(0,r.jsx)("div",{})}),t.noAccount&&!v&&(0,r.jsxs)("div",{style:{maxHeight:"800px"},children:[(0,r.jsxs)("div",{style:{padding:"0px 30px"},children:[(0,r.jsxs)(m.FJ,{style:{marginBottom:"4px"},children:[(0,r.jsx)("div",{children:i.general.signUp}),(0,r.jsx)("div",{style:{fontSize:"1.5rem"},children:S?i.authFormGeneral.readyToCreate:i.authFormGeneral.likeWhatYouSee})]}),S&&(0,r.jsx)("div",{style:{marginBottom:"6px"},children:(0,r.jsxs)(K.f4,{children:[(0,r.jsx)("span",{children:i.authFormGeneral.registerAndUnlock[0]}),(0,r.jsx)("strong",{children:i.authFormGeneral.registerAndUnlock[1]}),(0,r.jsx)("span",{children:i.authFormGeneral.registerAndUnlock[2]})]})}),D&&(0,r.jsx)("div",{style:{marginBottom:"6px"},children:(0,r.jsx)(K.f4,{children:(0,r.jsx)("span",{children:i.authFormGeneral.registerAndText})})}),(0,r.jsxs)("div",{style:{fontSize:"1rem",marginBottom:"10px"},children:[(0,r.jsxs)("span",{style:{opacity:"0.7"},children:[i.authFormGeneral.alreadyHaveAnAccount," "]}),(0,r.jsx)(j.Dp,{style:{opacity:"0.9"},onClick:()=>{o(!1),d(!0)},children:i.general.logIn})]})]}),(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%",minHeight:"0",position:"relative",alignItems:"center",flex:"1 1 0",overflowY:"auto",padding:"0px 30px 30px"},children:(0,r.jsxs)("div",{style:{width:"100%",minHeight:"0"},children:[(0,r.jsx)(W,{onRegister:U,setLoading:w,fullSetup:h}),(0,r.jsx)("div",{style:{height:"20px"}})]})})]}),!t.noAccount&&!t.information.emailVerified&&!v&&(0,r.jsxs)("div",{style:{maxHeight:"600px"},children:[(0,r.jsx)("div",{style:{padding:"0px 30px"},children:(0,r.jsxs)(m.FJ,{children:[(0,r.jsx)("div",{children:i.authFormGeneral.zoom}),(0,r.jsx)("div",{style:{fontSize:"1.5rem"},children:i.authFormGeneral.itsBeenSent})]})}),(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%",position:"relative",alignItems:"center",overflowY:"auto",padding:"0px 30px 30px"},children:(0,r.jsxs)("div",{style:{width:"100%"},children:[(0,r.jsx)(T.ConfirmationFormContent,{onConfirm:q,canUseTrial:p}),(0,r.jsx)("div",{style:{height:"20px"}})]})})]}),v&&(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",paddingBottom:"60px"},children:(0,r.jsx)(L.k,{visible:!0})})]})})}let V=D.Ay.div.withConfig({componentId:"sc-9d47cae6-1"})(["width:100%;background:",";border-radius:3px;border:1px solid ",";display:flex;flex-direction:column;padding-top:60px;max-width:410px;@media (max-width:800px){max-width:100%;}"],e=>e.theme.colors.bg2,e=>e.theme.colors.bg3)},58286:(e,t,n)=>{n.d(t,{M:()=>s,S:()=>a});let r=new Map,i=null,s=e=>{let t=Date.now(),n=r.get(e);if(!n||!(t-n<5e3)){for(let[n,i]of(r.set(e,t),r.entries()))t-i>3e4&&r.delete(n);window.dataLayer?.push({event:"purchase",product:e})}},a=()=>{let e=Date.now();i&&e-i<5e3||(i=e,window.dataLayer?.push({event:"register"}))}},97271:(e,t,n)=>{n.r(t),n.d(t,{ConfirmationFormContent:()=>v,default:()=>f});var r=n(94458),i=n(29415),s=n.n(i),a=n(21681),o=n.n(a),l=n(38474),d=n(68658),c=n(26907),h=n(92704),u=n(88587),m=n(89077),x=n(97223),g=n(2834),p=n(73484),y=n(27524);function f(){return(0,r.jsxs)(c.j$,{children:[(0,r.jsx)(o(),{children:(0,r.jsx)("title",{children:"Confirm Account - NovelAI"})}),(0,r.jsx)(c.yD,{}),(0,r.jsx)(j,{})]})}function j(){let e=(0,p.B2)(),t=(0,l.useRouter)(),n="false"!==t.query.trial;return(0,r.jsx)(c.Z3,{children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",height:"100%",width:"100%"},children:[(0,r.jsxs)(c.nR,{children:[(0,r.jsxs)(s(),{href:"/",passHref:!0,scroll:!1,children:[(0,r.jsx)(h.A60,{}),e.common.back]}),(0,r.jsx)(s(),{href:"/login",children:e.general.login})]}),(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%",minHeight:"0",position:"relative",alignItems:"center",justifyContent:"center",flex:"1 1 0"},children:(0,r.jsx)("div",{style:{width:"100%",maxHeight:"100%",position:"absolute",overflowY:"auto",display:"flex",justifyContent:"center"},children:(0,r.jsxs)("div",{style:{width:"100%",maxWidth:"290px",minHeight:"0"},children:[(0,r.jsxs)(c.FJ,{children:[(0,r.jsx)("div",{children:e.authFormGeneral.zoom}),(0,r.jsx)("div",{children:e.authFormGeneral.itsBeenSent})]}),(0,r.jsx)(v,{canUseTrial:n,onConfirm:e=>{t.push("/confirmation?token="+e.trim())}})]})})})]})})}function v(e){let t=(0,p.B2)(),n=(0,g.md)(x.hO),[i,s]=(0,d.useState)(!1),[a,o]=(0,d.useState)(""),[l,h]=(0,d.useState)(""),f=async()=>{o(""),s(!0);let e=(0,y.No)();try{let t=await fetch(u.e2.ResendVerifyEmail,{mode:"cors",cache:"no-store",headers:{"Content-Type":"application/json","x-correlation-id":e},method:"POST",body:JSON.stringify({email:n})});if(s(!1),t.ok)o("Resent confirmation mail!");else{let n=await t.json();o(`[${e}] ${n.message||"Something went wrong!"}`)}}catch(e){o(`${e}`),s(!1)}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{marginBottom:"10px"},children:t.authFormGeneral.aConfirmationEmail}),n?(0,r.jsx)(m.Dp,{disabled:i,style:{marginBottom:"10px"},onClick:e=>{e.preventDefault(),f()},children:t.authFormGeneral.resendEmail}):null,(0,r.jsx)("div",{style:{marginBottom:"10px"},children:t.authFormGeneral.clickTheLinkOrEnterCode}),(0,r.jsx)("input",{style:{marginBottom:"10px"},value:l,onChange:e=>h(e.target.value),type:"text"}),(0,r.jsx)(c.lF,{disabled:!l||64!==l.trim().length,onClick:t=>{t.preventDefault(),e.onConfirm(l)},children:t.cta.submit}),(0,r.jsx)("br",{}),(0,r.jsx)("p",{children:(0,r.jsx)("strong",{children:a})})]})}}}]);